name: "Helm Action"
description: "Perform someting with Helm in the cluster"
inputs:
  kubeconfig:
    description: "The path to the kubeconfig file"
    required: true
    default: "./kubeconfig"
  chart:
    description: "The chart to install"
    required: false
    default: ""
  release:
    description: "The release name"
    required: true
    default: "helm-example"
  version:
    description: "The chart version"
    required: false
    default: ""
  namespace:
    description: "The namespace to install the chart"
    required: true
    default: "default"
  command:
    description: "Command for the Helm action"
    required: true
    default: "upgrade"
  values-file:
    description: "Values file for the Helm chart"
    required: false
    default: "Values.yaml"
  values:
    description: "Values for the Helm chart"
    required: false
    default: ""
runs:
  using: "composite"
  steps:
    - name: "Build Docker image"
      shell: sh
      run: docker build -t helm-action .
    - name: "Installing or upgrading Helm chart"
      if: ${{ inputs.command == 'install' || inputs.command == 'upgrade' }}
      shell: sh
      run: |
        docker run --rm -v $PWD:/wd helm-action \
        ${{ inputs.command }} \
        ${{ inputs.release }} \
        ${{ inputs.chart }} \
        --version \
        ${{ inputs.version }} \
        -n \
        ${{ inputs.namespace }} \
        --create-namespace \
        -f \
        ${{ inputs.values-file }} \
        --kubeconfig \
        ${{ inputs.kubeconfig }}
    - name: "Uninstalling Helm chart"
      if: ${{ inputs.command == 'uninstall' }}
      shell: sh
      run: |
        docker run --rm -v $PWD:/wd helm-action \
        ${{ inputs.command }} \
        ${{ inputs.release }} \
        -n \
        ${{ inputs.namespace }} \
        --kubeconfig \
        ${{ inputs.kubeconfig }}
